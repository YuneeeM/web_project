<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>마이페이지</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">


  <style>
    body {
      background-color: #F1F5FF;
      font-family: 'Jua', sans-serif;
    }

    .logout {
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }


    .logout img:hover {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    /* 페이지 컨테이너 스타일 */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      border-radius: 32px;
      background-color: #FFFFFF;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    /* 제목 스타일 */
    h1 {
      text-align: center;
      color: #003F5F;
      margin-bottom: 40px;
      font-size: 50px;
    }

    h1 img {
      width: 40px;
      height: 40px;
      margin-right: 10px;
      margin-bottom: -8px;
      align-items: center;
      justify-content: center;
    }

    /* 박스 컨테이너 스타일 */
    .box-container {
      display: flex;
      justify-content: space-between;
      font-family: 'Jua', sans-serif;
    }

    /* 박스 스타일 */
    .box {
      flex-basis: calc(25% - 10px);
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid none;
      border-radius: 5px;
      background-color: #10a1fbbc;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #FFFFFF;
      font-size: 25px;
    }

    /* 박스 간격 */
    .box+.box {
      margin-inline-start: 20px;
    }

    /* 박스 호버 스타일 */
    .box:hover {
      background-color: #009FCB;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    /* 상세화면 스타일 */
    .detail {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid none;
      border-radius: 5px;
      background-color: #D2EDFF;

    }

    /* 상세화면 숨김 */
    .detail {
      display: none;
    }

    /* 상세화면 표시 */
    .detail.show {
      display: block;
    }

    #detail-1 img {
      margin-left: 20px;
      margin-right: 15px;
      margin-bottom: -15px;
    }

    #detail-1 h3 {
      margin-bottom: 45px;
      padding-bottom: -5px;
      font-size: 30px;
    }


    .change_user {
      width: 100px;
      height: 30px;
      font-family: 'Jua', sans-serif;
      float: right;
      border-radius: 35px;
      border: 1px solid inherit;
      background-color: #08c2f6;
      color: #FFFFFF;
      text-align: center;
      padding-top: 10px;
    }

    .change_user:hover {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      background-color: #0892f6;
    }

    #detail-4 table,
    #detail-3 table,
    #detail-2 table {
      border-collapse: collapse;
      text-align: center;
    }

    #detail-4 thead,
    #detail-3 thead,
    #detail-2 thead {
      display: table-header-group;
      vertical-align: middle;
    }

    #detail-4>table>thead>tr,
    #detail-3>table>thead>tr,
    #detail-2>table>thead>tr {
      background-color: #0892f6;
      color: #FFFFFF;
      height: 20px;
      border-bottom: 2px solid slategray;
    }

    table th,
    table td {
      padding: 8px;
      border-right: 1px solid #ccc;
      border-bottom: 1px solid #ccc;
    }

    table th:last-child,
    table td:last-child {
      border-right: none;
    }

    #like img {
      margin-right: 5px;

    }

    #like {
      margin-top: -10px;
    }

    #menu_bar {
      position: fixed;
      top: 0;
      width: 50px;
      height: 100%;
      background-color: #0099FF;
      z-index: 3;
      overflow: hidden;
      transition: width 0.3s;
    }

    #menu_bar:hover {
      width: 250px;
    }

    #menu_bar ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 100px;
    }

    #menu_bar li {
      position: relative;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      width: 100%;
      height: 55px;
      border-bottom: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #menu_bar li:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    #menu_bar li .menu_icon {
      width: 30px;
      height: 30px;
      margin-right: 10px;
      background-size: cover;
      opacity: 1;
      transition: opacity 0.3s;
    }

    #menu_bar li:hover .menu_icon {
      opacity: 1;
    }

    #menu_bar li .menu_text {
      position: absolute;
      left: -9999px;
      color: #fff;
    }

    #menu_bar:hover li .menu_text {
      left: 0;
      margin-left: 40px;
      font-size: 25px;
    }

    .icon1 {
      background: url('media/007.png') center center no-repeat;
    }

    .icon2 {
      background: url('media/006.png') center center no-repeat;
    }

    .icon3 {
      background: url('media/004.png') center center no-repeat;
    }

    .icon4 {
      background: url('media/003.png') center center no-repeat;
    }

    .icon5 {
      background: url('media/005.png') center center no-repeat;
    }

    .icon6 {
      background: url('media/002.png') center center no-repeat;
    }

    .icon7 {
      background: url('media/001.png') center center no-repeat;
    }
  </style>

  <script>
    // 상세화면 표시 함수
    function showDetail(detailId) {
      // 모든 상세화면 숨김
      var details = document.getElementsByClassName("detail");
      for (var i = 0; i < details.length; i++) {
        details[i].classList.remove("show");
      }

      // 선택한 상세화면 표시
      document.getElementById(detailId).classList.add("show");
    }

  </script>
</head>

<body>

  <nav id="menu_bar">
    <div id="menu_nav">
      <ul>
        <li onclick="checkAuthTokenAndRedirect('bokjiapi_homeless.html')">
          <span class="menu_icon icon1"></span>
          <span class="menu_text">노숙인 복지시설</span>
        </li>
        <li onclick="checkAuthTokenAndRedirect('bokjiapi_order.html')">
          <span class="menu_icon icon2"></span>
          <span class="menu_text">노인 복지시설</span>
        </li>
        <li onclick="checkAuthTokenAndRedirect('worknet_post.html')">
          <span class="menu_icon icon3"></span>
          <span class="menu_text">구인정보(사기업)</span>
        </li>
        <li onclick="checkAuthTokenAndRedirect('openapi_workpost.html')">
          <span class="menu_icon icon4"></span>
          <span class="menu_text">구인정보(공공)</span>
        </li>
        <li onclick="location.href='self_check_nutrition.html'">
          <span class="menu_icon icon5"></span>
          <span class="menu_text">건강 및 영양</span>
        </li>
        <li onclick="location.href='main_post.html'">
          <span class="menu_icon icon6"></span>
          <span class="menu_text">자유게시판</span>
        </li>
        <li onclick="checkAuthTokenAndRedirect_login('mypage.html')">
          <span class="menu_icon icon7"></span>
          <span class="menu_text">마이페이지</span>
        </li>
      </ul>
    </div>
  </nav>

  <div class="logout" onclick="logout()"><span>로그아웃</span><img src="media/free-icon-sign-out-7046204.png" alt="로그아웃"
      width="60px" height="50px"></div>
  <div class="container">
    <h1 style="text-align: center; color:#003F5F"><img src="media/free-icon-developer-4293722.png">마이페이지</h1>

    <!-- 박스 컨테이너 -->
    <div class="box-container">
      <!-- 회원정보 박스 -->
      <div class="box" onclick="showDetail1()">회원정보</div>

      <!-- 작성기록 박스 -->
      <div class="box" onclick="showDetail('detail-2'), addWrotePostsToTable()">게시물 작성</div>

      <!-- 좋아요한 게시물 박스 -->
      <div class="box" onclick="showDetail('detail-3'), addLikedPostsToTable()">좋아요한 게시물</div>

      <!-- 좋아요한 일자리 박스 -->
      <div class="box" onclick="showDetail('detail-4'), addLikedJobsToTable()">좋아요한 일자리</div>
    </div>

    <!-- 회원정보 1 -->
    <div id="detail-1" class="detail">
      <!-- 회원정보 상세화면 내용 -->
      <div class="change_user" onclick="goChangePage()">수정하기</div>
      <h3 id="id"><img src="media/free-icon-smart-id-7435734.png" width="40px" height="40px">아이디 : <span id="d_id">웃는
          시간</span></h3>
      <h3 id="pw"><img src="media/free-icon-password-6772337.png" width="40px" height="40px">비밀번호 : <span id="d_pw">웃는
          시간</span></h3>
      <h3 id="phone"><img src="media/free-icon-social-media-7440003.png" width="40px" height="40px">전화번호 : <span
          id="d_phone">웃는 시간</span></h3>
      <h3 id="birth"><img src="media/free-icon-date-of-birth-8926835.png" width="40px" height="40px">생년월일 : <span
          id="d_birth">웃는 시간</span></h3>
      <h3 id="age"><img src="media/free-icon-age-3788610.png" width="40px" height="40px">나이 : <span id="d_age">웃는
          시간</span></h3>
      <h3 id="gender"><img src="media/free-icon-gender-4214361.png" width="40px" height="40px">성별 : <span
          id="d_gender">웃는 시간</span></h3>
      <h3 id="city"><img src="media/free-icon-cityscape-2451728.png" width="40px" height="40px">거주지 : <span
          id="d_city">웃는 시간</span></h3>
      <h3 id="income"><img src="media/free-icon-income-chart-7650916.png" width="40px" height="40px">평균 소득 : <span
          id="d_income">웃는 시간</span></h3>
      <h3 id="gagu"><img src="media/free-icon-family-3321905.png" width="40px" height="40px">가구유형 : <span id="d_gagu">웃는
          시간</span></h3>
      <h3 id="job"><img src="media/free-icon-search-job-1215725.png" width="40px" height="40px">직업 : <span id="d_job">웃는
          시간</span></h3>
      <h3 id="edu"><img src="media/free-icon-school-desk-6917653.png" width="40px" height="40px">학력 : <span
          id="d_edu">웃는 시간</span></h3>
    </div>

    <!-- 상세화면 2 -->
    <div id="detail-2" class="detail">
      <!-- 상세화면 내용 -->
      <!-- 상세화면 내용 -->
      <h3 id="like"><img src="media/free-icon-hearts-138533.png" width="20px" height="20px" alt="좋아요">작성한 게시물</h3>
      <table>
        <thead>
          <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>좋아요 수</th>
            <th>등록일</th>
          </tr>
          <colgroup>
            <col width="10%">
            <col width="30%">
            <col width="20%">
            <col width="20%">
            <col width="20%">
          </colgroup>
        </thead>
        <tbody id="wrote-posts">
          <!-- 좋아요한 게시물 행들이 여기에 동적으로 추가될 것입니다 -->
        </tbody>
      </table>
      <p id="message"></p>

    </div>

    <!-- 상세화면 3 -->
    <div id="detail-3" class="detail">
      <!-- 상세화면 내용 -->
      <h3 id="like"><img src="media/free-icon-hearts-138533.png" width="20px" height="20px" alt="좋아요">좋아요한 게시물</h3>
      <table>
        <thead>
          <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>좋아요 수</th>
            <th>등록일</th>
          </tr>
          <colgroup>
            <col width="10%">
            <col width="30%">
            <col width="20%">
            <col width="20%">
            <col width="20%">
          </colgroup>
        </thead>
        <tbody id="liked-posts">
          <!-- 좋아요한 게시물 행들이 여기에 동적으로 추가될 것입니다 -->
        </tbody>
      </table>
      <p id="message"></p>
    </div>

    <!-- 상세화면 4 -->
    <div id="detail-4" class="detail">
      <!-- 상세화면 내용 -->
      <h3 id="like"><img src="media/free-icon-hearts-138533.png" width="20px" height="20px" alt="좋아요">좋아요한 일자리</h3>
      <table>
        <thead>
          <tr>
            <th>회사명/정보제공처</th>
            <th>채용공고명/담당업무/지원자격</th>
            <th>근무조건</th>
            <th>등록/마감일</th>
            <th>정보제공</th>
          </tr>
          <colgroup>
            <col width="15%">
            <col width="35%">
            <col width="20%">
            <col width="20%">
            <col width="10%">
          </colgroup>
        </thead>
        <tbody id="liked-jobs">
          <!-- 좋아요한 일자리 행들이 여기에 동적으로 추가될 것입니다 -->
        </tbody>
      </table>
      <p id="message"></p>
    </div>
  </div>


  <script>

    //html 버튼 요소를 가져옴
    var main_button = document.querySelectorAll('.box');

    //버튼 클릭 이벤트에 대한 핸들러 함수 정의
    function buttonClickHandler(event) {
      //선택된 버튼의 색상과 스타일 변경
      main_button.forEach(function (button) {
        if (button == event.target) {
          button.style.backgroundColor = '#009FCB';
          button.style.boxShadow = "0 0 10px rgba(0, 0, 0, 0.2)";
        } else {
          button.style.backgroundColor = '#10a1fbbc';
          button.style.boxShadow = "none";
        }
      });
    }

    // 각 버튼에 클릭 이벤트 핸들러를 등록합니다.
    main_button.forEach(function (button) {
      button.addEventListener('click', buttonClickHandler);
    });


    // 상세화면 표시 함수
    function showDetail(detailId) {
      var detailElement = document.getElementById(detailId);

      // 상세화면이 이미 표시되어 있는 경우 숨김 처리
      if (detailElement.classList.contains("show")) {
        detailElement.classList.remove("show");
      } else {
        // 모든 상세화면 숨김
        var details = document.getElementsByClassName("detail");
        for (var i = 0; i < details.length; i++) {
          details[i].classList.remove("show");
        }

        // 선택한 상세화면 표시
        detailElement.classList.add("show");
      }
    }


    // 수정하기 페이지로 이동
    function goChangePage() {
      window.location.href = "userchange_page.html";
    }

    //상세화면 1
    function showDetail1() {
      // 모든 상세화면 숨김
      var details = document.getElementsByClassName("detail");
      for (var i = 0; i < details.length; i++) {
        details[i].classList.remove("show");
      }

      // 선택한 상세화면 표시
      var detail1 = document.getElementById("detail-1");
      detail1.classList.add("show");

      // 로컬스토리지에서 토큰값(personid) 가져오기
      var token = parseInt(localStorage.getItem('authToken'));

      // 로컬스토리지에서 users 배열 가져오기
      var storedUsers = JSON.parse(localStorage.getItem('users'));

      var printcontent = storedUsers.find(function (user) {
        return user.personid === token;
      });


      document.getElementById('d_id').textContent = printcontent.userid;
      document.getElementById('d_pw').textContent = printcontent.password;
      document.getElementById('d_phone').textContent = printcontent.phone;
      document.getElementById('d_birth').textContent = printcontent.birth;
      document.getElementById('d_age').textContent = printcontent.age;
      document.getElementById('d_gender').textContent = printcontent.gender;
      document.getElementById('d_city').textContent = printcontent.residence;
      document.getElementById('d_income').textContent = printcontent.income;
      document.getElementById('d_gagu').textContent = printcontent.gagu;
      document.getElementById('d_job').textContent = printcontent.occupation;
      document.getElementById('d_edu').textContent = printcontent.education;

    }

    function addWrotePostsToTable() {
      var tbody = document.getElementById("wrote-posts");
      var messageElement = document.getElementById("message");

      // 기존 내용 초기화
      tbody.innerHTML = "";

      // 로컬 스토리지에서 데이터 가져오기
      var users = JSON.parse(localStorage.getItem("users"));
      var post_list = JSON.parse(localStorage.getItem("post_list")) || [];
      // localStorage에서 authToken 가져오기
      var token = parseInt(localStorage.getItem("authToken"));


      var print_value = users.find(function (user) {
        return user.personid === token;
      });

      console.log(print_value);


      const userId = print_value.userid;


      var filteredPosts = [];

      // userid와 동일한 writer를 가진 게시물 추출
      var filteredPosts = post_list.filter(function (post) {
        return String(post.writer) === String(userId);
      });


      console.log(filteredPosts.length);
      console.log(filteredPosts);


      // 작성한 게시물이 없는 경우 메시지 출력
      if (filteredPosts.length === 0) {
        tbody.innerHTML = "<tr><td colspan='6'> 작성하신 게시물이 없습니다.</td></tr>";
      }

      if (filteredPosts.length > 0) {
        // post_list의 게시물을 테이블에 추가
        filteredPosts.forEach(function (post) {
          var row = document.createElement("tr");
          row.innerHTML = `
          <td>${post.postNumber}</td>
          <td>${post.title}</td>
          <td>${post.writer}</td>
          <td>${post.likes}</td>
          <td>${post.createdDate}</td>`;
          row.addEventListener("click", function () {
            // 클릭 이벤트 처리
            // 상세게시판 페이지로 이동하고, 데이터를 전달하는 로직을 구현
            // 예시: 상세게시판 페이지로 postId 전달
            window.location.href = "post_detail.html?id=" + post.postNumber;
          });
          tbody.appendChild(row);
        });
      } else {
        messageElement.innerText = "작성한 게시물이 없습니다.";
      }
    }

    // 페이지가 로드될 때 작성한 게시물 테이블에 추가
    window.addEventListener("DOMContentLoaded", addWrotePostsToTable);


    // 좋아요한 게시물을 테이블에 동적으로 추가하는 함수
    function addLikedPostsToTable() {

      var tbody = document.getElementById("liked-posts");
      var messageElement = document.getElementById("message");

      // 기존 내용 초기화
      tbody.innerHTML = "";

      // localStorage에서 like_posts 가져오기
      var likePosts = JSON.parse(localStorage.getItem("like_posts")) || [];

      // localStorage에서 authToken 가져오기
      var token = parseInt(localStorage.getItem("authToken")) || 0;


      // authToken과 token값이 일치하는 경우에만 테이블에 추가
      var filteredpostList = likePosts.filter(function (post) {
        return String(post.token) === String(token);
      });

      // 좋아요를 누른 일자리가 없는 경우 메시지 출력
      if (filteredpostList.length === 0) {
        tbody.innerHTML = "<tr><td colspan='6'>좋아요를 누른 게시물이 없습니다.</td></tr>";
      }

      if (filteredpostList.length > 0) {
        // like_posts의 게시물을 테이블에 추가
        filteredpostList.forEach(function (post) {
          var row = document.createElement("tr");
          row.innerHTML = `
    <td>${post.postId}</td>
    <td>${post.data.title}</td>
    <td>${post.data.writer}</td>
    <td>${post.data.likes}</td>
    <td>${post.data.createdDate}</td>
`;
          row.addEventListener("click", function () {
            // 클릭 이벤트 처리
            // 상세게시판 페이지로 이동하고, 데이터를 전달하는 로직을 구현
            // 예시: 상세게시판 페이지로 postId 전달
            window.location.href = "post_detail.html?id=" + post.postId;
          });
          tbody.appendChild(row);
        });
      } else {
        messageElement.innerText = "좋아요를 눌린 게시물이 없습니다.";
      }
    }

    // 페이지가 로드될 때 좋아요한 게시물을 테이블에 추가
    window.addEventListener("DOMContentLoaded", addLikedPostsToTable);


    // 좋아요한 일자리를 테이블에 동적으로 추가하는 함수
    function addLikedJobsToTable() {

      var tbody = document.getElementById("liked-jobs");
      var messageElement = document.getElementById("message");

      // 기존 내용 초기화
      tbody.innerHTML = "";

      // localStorage에서 worknet_list 가져오기
      var worknetList = JSON.parse(localStorage.getItem("worknet_list")) || [];

      // localStorage에서 openapi_list 가져오기
      var openapiList = JSON.parse(localStorage.getItem("openapi_list")) || [];

      // localStorage에서 authToken 가져오기
      var token = parseInt(localStorage.getItem("authToken")) || 0;


      // authToken과 personid 값이 일치하는 경우에만 테이블에 추가
      var filteredWorknetList = worknetList.filter(function (job) {
        return String(job.personid) === String(token);
      });

      var filteredOpenapiList = openapiList.filter(function (job) {
        return String(job.personid) === String(token);
      });


      // 좋아요를 누른 일자리가 없는 경우 메시지 출력
      if (filteredWorknetList.length === 0 && filteredOpenapiList.length === 0) {
        tbody.innerHTML = "<tr><td colspan='6'>좋아요를 누른 일자리가 없습니다.</td></tr>";
      }

      if (filteredWorknetList.length > 0 || filteredOpenapiList.length > 0) {
        // worknet_list의 일자리를 테이블에 추가
        filteredWorknetList.forEach(function (job) {
          var row = document.createElement("tr");
          row.innerHTML = `
          <td>${job.company}</td>
          <td>${job.title}</td>
          <td>${job.working}</td>
          <td>${job.date}</td>
          <td>${job.info}</td>
      `;
          row.addEventListener("click", function () {
            // 클릭 이벤트 처리
            // 상세게시판 페이지로 이동하고, 데이터를 전달하는 로직을 구현
            window.location.href = "worknet_details.html?company=" + job.company + "&jobTitle=" + job.title + "&workingCondition=" + job.working + "&registrationDate=" + job.date;
          });
          tbody.appendChild(row);
        });


        // openapi_list의 일자리를 테이블에 추가
        filteredOpenapiList.forEach(function (job) {
          var row = document.createElement("tr");
          row.innerHTML = `
          <td>${job.company}</td>
          <td>${job.title}</td>
          <td>${job.working}</td>
          <td>${job.date}</td>
          <td>${job.info}</td>
      `;

          row.addEventListener("click", function () {
            // 클릭 이벤트 처리
            // 상세게시판 페이지로 이동하고, 데이터를 전달하는 로직을 구현
            window.location.href = "openapi_details.html?company=" + job.company + "&jobTitle=" + job.title + "&workingCondition=" + job.working + "&registrationDate=" + job.date;
          });
          tbody.appendChild(row);
        });
      } else {
        messageElement.innerText = "좋아요를 눌린 일자리가 없습니다.";
      }
    }

    // 페이지가 로드될 때 좋아요한 일자리를 테이블에 추가
    window.addEventListener("DOMContentLoaded", addLikedJobsToTable);

    function logout() {
      // 확인 메시지 출력
      var confirmLogout = confirm("정말 로그아웃하시겠습니까?");

      if (confirmLogout) {
        // authToken 값을 null로 변경
        localStorage.setItem("authToken", 0);

        // startpage.html로 이동
        window.location.href = "startpage.html";
      }
    }
  </script>

  <script>
    function checkAuthTokenAndRedirect(page) {
      // localStorage에서 authToken 가져오기
      var token = parseInt(localStorage.getItem("authToken"));


      if (token === 0) {
        location.href = 'memberinfo_post.html';
      } else {
        location.href = page;
      }
    }
    function checkAuthTokenAndRedirect_login(page) {
      // localStorage에서 authToken 가져오기
      var token = parseInt(localStorage.getItem("authToken"));

      if (token === 0) {

        // 확인 메시지 출력
        var confirmLogin = confirm("로그인을 하셔야 접속할 수 있습니다!");

        if (confirmLogin) {

          window.location.href = 'loginpage.html';
        }
        else {
        }

      } else {
        location.href = page;
      }
    }
  </script>
</body>

</html>