<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="style_workpost.css" />
  <title>노인 일자리 현황(공공)</title>
</head>

<body>

  <div id="content">
    <div id="default_box">
      <h1 class="title title_content">구인정보(공공)</h1>
      <span class="title_sub">앞선 맞춤형 정보 기반으로 구인정보을 알려드립니다.</span>
    </div>
    <!--리스트형태 시작-->
    <table class="board-list" style="width: 100%" ;>
      <colgroup>
        <col width="5%">
        <col width="45%">
        <col width="25%">
        <col width="25%">
      </colgroup>
      <thead>
        <tr>
          <th>회사명/정보제공처</th>
          <th>채용공고명/담당업무/지원자격</th>
          <th>근무조건</th>
          <th>등록/마감일</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td></td>
        </tr>
      </tbody>
    </table>

  </div>

  <!--부산광역시_공공부문 일자리(채용) 정보-->

  <p id="sample_data"></p>

  <div id="pagination"></div>

  <script>
    const url = 'https://apis.data.go.kr/6260000/BusanJobOpnngInfoService/getJobOpnngInfo?serviceKey=&numOfRows=50&pageNo=1&resultType=json';
    const pageSize = 5; // 페이지당 리스트 개수

    const table = document.querySelector('.board-list');
    const tbody = table.querySelector('tbody');
    const paginationContainer = document.getElementById('pagination');
    const dataPane = document.getElementById('sample_data');

    let currentPage = 1; // 현재 페이지 번호
    let totalData = 0; // 전체 데이터 항목 개수

    function updateTableData(page) {
      const start = (page - 1) * pageSize; // 현재 페이지에 해당하는 데이터 시작 인덱스
      const end = start + pageSize; // 현재 페이지에 해당하는 데이터 끝 인덱스

      fetch(url)
        .then((res) => res.json())
        .then((resJson) => {
          if (
            resJson.getJobOpnngInfo &&
            resJson.getJobOpnngInfo.body &&
            resJson.getJobOpnngInfo.body.items
          ) {
            const items = resJson.getJobOpnngInfo.body.items.item;
            const filteredData = items.filter((item) => {
              const workDateTypes = item.workDate_type.split(',');
              return (
                workDateTypes.includes('무기계약직') ||
                workDateTypes.includes('비정규직') ||
                workDateTypes.includes('정규직')
              );
            });

            totalData = filteredData.length; // 전체 데이터 항목 개수 업데이트

            if (totalData > 0) {
              tbody.innerHTML = ''; // 이전 데이터 지우기

              for (let i = start; i < end && i < totalData; i++) {
                const item = filteredData[i];
                const row = document.createElement('tr');

                // 회사명/정보제공처
                const companyCell = document.createElement('td');
                companyCell.textContent = item.recruitAgencyName;
                row.appendChild(companyCell);

                // 채용공고명/담당업무/지원자격
                const recruitmentCell = document.createElement('td');
                recruitmentCell.textContent = item.title;
                row.appendChild(recruitmentCell);

                // 근무조건
                const workConditionCell = document.createElement('td');
                workConditionCell.textContent = item.workDate_nm + ' ~ ' + item.workregiontxt;
                row.appendChild(workConditionCell);

                // 등록/마감일
                const dateCell = document.createElement('td');
                dateCell.textContent = item.reqDate_s + ' ~ ' + item.reqDate_e;
                row.appendChild(dateCell);

                tbody.appendChild(row);
              }

              dataPane.innerText = '조건을 만족하는 데이터가 있습니다.';
            } else {
              tbody.innerHTML = ''; // 이전 데이터 지우기
              dataPane.innerText = '';
            }
          } else {
            dataPane.innerText = '데이터가 올바르게 구조화되어 있지 않습니다.';
          }

          // 페이지네이션 컨트롤 업데이트
          updatePagination();
        })
        .catch((error) => {
          console.log(error);
        });
    }

    // 현재 페이지와 전체 데이터 항목에 기반하여 페이지네이션 컨트롤 업데이트하는 함수
    function updatePagination() {
      paginationContainer.innerHTML = ''; // 이전 페이지네이션 컨트롤 지우기

      const totalPages = Math.ceil(totalData / pageSize);

      // 페이지네이션 버튼 생성 및 추가
      for (let i = 1; i <= totalPages; i++) {
        const button = document.createElement('button');
        button.textContent = i;
        button.addEventListener('click', () => {
          currentPage = i;
          updateTableData(currentPage);
        });
        paginationContainer.appendChild(button);
      }
    }

    // 초기 데이터 로딩
    updateTableData(currentPage);
  </script>


</body>

</html>